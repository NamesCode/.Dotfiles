"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[6025],{22578:(e,r,n)=>{n.d(r,{$:()=>f});n(26699),n(32023),n(69600),n(68309),n(21249);var t=n(64593),i=n(96206),a=n(69691),c=n(8341),o=n(89952),s=n(67294),l=n(51615),u=n(24183),d=n(85893);function v(e){return e.includes("Spotify")?e:"Spotify – ".concat(e)}var f=function(e){var r,n,f,g,m,y,p,b=e.children,h=e.usePlayingItem,x=v(b);r=b,g=(0,u.Oh)().mainLandmarkRef,m=(0,l.k6)(),y=null===(n=m.location)||void 0===n||null===(f=n.state)||void 0===f?void 0:f.preventMoveFocus,(p=(0,s.useRef)(m.length<2)).current=m.length<2,(0,s.useEffect)((function(){var e=g.current;!y&&!p.current&&e&&r&&(e.setAttribute("aria-label",r),e.focus())}),[r,g,y]);var k=(0,a.IK)().isPlaying,j=(0,c.Y)((function(e){return null==e?void 0:e.item}));return j&&(k||h)&&((0,o.G_)(j)?x=[j.name,j.artists.map((function(e){return e.name})).join(i.ag.getSeparator())].join(" • "):(0,o.iw)(j)?x=[j.name,j.show.name].join(" • "):(0,o.k6)(j)&&(x=v(i.ag.get("ad-formats.advertisement")))),(0,d.jsx)(t.q,{defaultTitle:"Spotify",defer:!1,children:(0,d.jsx)("title",{children:x})})}},70369:(e,r,n)=>{n.d(r,{$:()=>t.$});var t=n(22578)},18130:(e,r,n)=>{n.r(r),n.d(r,{default:()=>Fe});var t=n(4942),i=n(35150),a=n(86706),c=n(69518),o=n.n(c),s=n(73012),l=n(87577),u=n(37081),d=n(49207),v=n(39270),f=n(8341),g=n(55799),m=n(49104),y=n(70369),p=n(57451),b=n(15861),h=n(87757),x=n.n(h),k=n(88767),j=(n(21249),n(96511)),S=n(6086);var L=n(68120);function N(e,r,n){return w.apply(this,arguments)}function w(){return(w=(0,b.Z)(x().mark((function e(r,n,t){var i,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,L.S)(r,n,t);case 3:return a=e.sent,e.abrupt("return",{hasLyrics:!0,isTimeSynced:D(a.lyrics.syncType),syncType:a.lyrics.syncType,lyrics:a.lyrics.lines.map(O),colors:I(a.colors),provider:a.lyrics.provider,providerDisplayName:a.lyrics.providerDisplayName,providerLyricsId:a.lyrics.providerLyricsId,hasVocalRemoval:null!==(i=a.hasVocalRemoval)&&void 0!==i&&i});case 7:if(e.prev=7,e.t0=e.catch(0),!(e.t0 instanceof j.m&&404===e.t0.status)){e.next=11;break}return e.abrupt("return",{hasLyrics:!1});case 11:throw e.t0;case 12:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function O(e,r,n){var t=e.startTimeMs,i=e.words,a=n[r+1];return{start:t||0,end:a&&a.startTimeMs?a.startTimeMs:1/0,text:i}}function I(e){return{text:T(e.text),activeText:T(e.highlightText),background:T(e.background)}}function T(e){var r=function(e){return{r:e>>16&255,g:e>>8&255,b:255&e}}(e);return S.I.fromRGB(r).toCSS(S.j.RGB)}function D(e){return"LINE_SYNCED"===e||"SYLLABLE_SYNCED"===e}var E=18e5,_=function(e,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=["lyrics",{uri:e,image:r,vocalRemoval:n}],i=(0,k.useQuery)(t,(0,b.Z)(x().mark((function t(){return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&r&&o().isTrack(e)){t.next=2;break}return t.abrupt("return",{hasLyrics:!1});case 2:return t.next=4,N(e,r,n);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)}))),{cacheTime:E}),a=i.data,c=i.isLoading,s=i.isError;return{data:null!=a?a:null,loading:c,error:s}},C=n(93433),B=n(29439),P=(n(92222),n(34553),n(47941),n(82526),n(57327),n(41539),n(38880),n(89554),n(54747),n(49337),n(33321),n(69070),n(67294)),G=n(32667),F=n(81898),V=n(96206),A=n(23716),R=n(52759),Z=n(15852),Y=n(24643),H=n(8271);var M=n(97650),U=n(32648);const W="lyrics-lyrics-contentContainer",z="lyrics-lyrics-contentWrapper",J="lyrics-lyricsContent-lyric",q="lyrics-lyricsContent-active",K="lyrics-lyricsContent-highlight",Q="lyrics-lyricsContent-unsynced",$="lyrics-lyricsContent-provider",X="lyrics-lyricsContent-description";var ee=n(85893),re=P.memo((function(e){var r,n=e.onObserve,a=e.text,c=e.lineNumber,o=e.activeLineIndex,s=e.isTimeSynced,l=e.handleLyricsClick,u=(0,M.YD)({threshold:0,triggerOnce:!0}),d=u.ref,v=u.inView;(0,P.useEffect)((function(){v&&n(a)}),[v,n,a]);var f=(0,P.useRef)(),g=(0,P.useRef)(!0),m=(0,P.useContext)(U.VX);(0,P.useEffect)((function(){if(s&&o===c||s&&0===c&&o<0){var e,r,n,t=null===(e=f.current)||void 0===e?void 0:e.getBoundingClientRect().top,i=null===(r=m.scrollNodeRef.current)||void 0===r?void 0:r.getBoundingClientRect().height,a=i/4;if((t<a||t>i-a)&&!g.current&&o>=0)return;var l=g.current?"auto":"smooth";null===(n=f.current)||void 0===n||n.scrollIntoView({behavior:l,block:"center",inline:"center"})}g.current=!1}),[o,s,c,f,m]);var y=(0,P.useCallback)((function(e){d(e),f.current=e||void 0}),[d]);return(0,ee.jsx)("div",{dir:"auto",className:(0,i.cx)(J,(r={},(0,t.Z)(r,q,o===c),(0,t.Z)(r,K,o>c),(0,t.Z)(r,Q,!s),r)),"data-testid":"fullscreen-lyric",ref:y,onClick:function(e){return l(e,c)},children:a})}));function ne(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function te(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?ne(Object(n),!0).forEach((function(r){(0,t.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ne(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var ie={start:0,end:1,text:""},ae=P.memo((function(e){var r=e.trackUri,n=e.data,t=n.lyrics,i=void 0===t?[]:t,a=n.provider,c=n.providerLyricsId,o=n.providerDisplayName,s=n.syncType,l=n.isTimeSynced,u=(0,Z.fU)(F.createDesktopLyricsEventFactory,{data:{uri:r}}),d=u.spec,v=u.logger,g=(0,R.z)(500,(function(e){var n;return(null==e||null===(n=e.item)||void 0===n?void 0:n.uri)===r})),m=(0,B.Z)(g,1)[0],y=(0,f.Y)((function(e){var r;return null!==(r=null==e?void 0:e.playbackId)&&void 0!==r?r:void 0})),p=function(e){var r=e.trackUri,n=e.format,t=e.provider,i=e.providerLyricsId,a=e.syncType,c=e.playbackId,o=(0,P.useState)(!1),s=(0,B.Z)(o,2),l=s[0],u=s[1],d=(0,P.useState)(0),v=(0,B.Z)(d,2),f=v[0],g=v[1],m=(0,P.useMemo)((function(){return(0,Y.N)({lyrics_format:n,track_uri:r,provider:t,provider_lyrics_id:i,sync_type:a,playback_id:c})}),[n,t,i,a,r,c]);(0,P.useEffect)((function(){u(!1),g(0)}),[m]);var y=(0,H.s4)();return(0,P.useEffect)((function(){l||f>=140&&(y.send(m),u(!0))}),[f,l,m,y]),g}({trackUri:r,format:"fullscreen",provider:a,providerLyricsId:c,syncType:s,playbackId:y}),b=(0,P.useCallback)((function(e){e.length>1&&p((function(r){return r+e.length}))}),[p]),h=(0,P.useMemo)((function(){return[ie,ie].concat((0,C.Z)(i)).map((function(e,r){return te(te({},e),{},{lineNumber:r})}))}),[i]),x=l?h.findIndex((function(e){var r=e.start,n=e.end;return m>=r&&m<n})):-1,k=(0,A.g)(),j=(0,P.useCallback)((function(e,r){if(l){var n=h[r].start,t=d.lyricsLineFactory().hitSeekToTime({msToSeekTo:n});v.logInteraction(t),e.target.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),k.seekTo(n);var i=k.getState();i&&!i.isPaused||k.resume()}}),[l,v,h,k,d]);return(0,ee.jsx)("div",{className:W,children:(0,ee.jsxs)("div",{className:z,children:[!l&&(0,ee.jsx)(G.D,{as:"p",variant:"mesto",className:X,dir:"auto",children:V.ag.get("web-player.lyrics.unsynced")}),h.map((function(e){var r=e.text,n=e.lineNumber;return(0,ee.jsx)(re,{text:r,lineNumber:n,activeLineIndex:x,isTimeSynced:l,onObserve:b,handleLyricsClick:j},n)})),o&&(0,ee.jsx)(G.D,{as:"p",variant:"mesto",className:$,dir:"auto",children:V.ag.get("web-player.lyrics.providedBy",o)})]})})})),ce=n(38470);const oe="lyrics-lyrics-container",se="IIFWQwWvkxpl3swKeHSx",le="ihTTWcgqNLcQ_cg7Bubg",ue="T67LFP0PElpfkkLuegQt",de="lyrics-lyrics-background",ve="YRcOaDMQH71HylItIhW6",fe="EKdvOmPl7kNCDg_yuma8";var ge=(0,P.memo)((function(e){var r,n=e.version,t=[V.ag.get("web-player.lyrics.noLyrics0"),V.ag.get("web-player.lyrics.noLyrics1"),V.ag.get("web-player.lyrics.noLyrics2"),V.ag.get("web-player.lyrics.noLyrics3")];switch(n){case"ad":r=V.ag.get("web-player.lyrics.ad");break;case"error":r=V.ag.get("web-player.lyrics.error");break;case"unavailable":r=t[Math.floor(Math.random()*t.length)];break;default:(0,ce.U)(n)}return(0,ee.jsx)("div",{className:ue,children:(0,ee.jsx)("span",{className:fe,children:r})})})),me=(n(69826),n(94184)),ye=n.n(me),pe=n(92949),be=n(96314),he=n(21864),xe=n(64570),ke=n(34142),je=n(47921),Se=n(32626),Le=n(30005),Ne=n(36652),we=n(21691),Oe=n(66587);const Ie="qnJd7AVNVGM33NxaibzG",Te="tPJJwfJAQV0WDsE9Kfmd";var De=[{volume:Oe.B.SING_ALONG_OFF,icon:(0,ee.jsx)(pe.D,{iconSize:16}),get label(){return V.ag.get("singalong.off")}},{volume:Oe.B.HIGH,icon:(0,ee.jsx)(be.d,{iconSize:16}),get label(){return V.ag.get("singalong.more-vocal")}},{volume:Oe.B.LOW,icon:(0,ee.jsx)(he.J,{iconSize:16}),get label(){return V.ag.get("singalong.less-vocal")}}],Ee=P.memo((function(e){var r=function(e){var r=(0,g.$)(),n=(0,P.useState)(Oe.B.SING_ALONG_OFF),t=(0,B.Z)(n,2),i=t[0],a=t[1],c=r.getCapabilities().isSupported;(0,P.useEffect)((function(){r.setStatus(Oe.q.DISABLED).then((function(){a(Oe.B.SING_ALONG_OFF)}))}),[e,r]),(0,P.useEffect)((function(){return function(){r.setStatus(Oe.q.DISABLED)}}),[r]);var o=(0,P.useCallback)(function(){var e=(0,b.Z)(x().mark((function e(n){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n!==Oe.B.SING_ALONG_OFF){e.next=5;break}return e.next=3,r.setStatus(Oe.q.DISABLED);case 3:e.next=7;break;case 5:return e.next=7,r.setStatus(Oe.q.ENABLED);case 7:return e.next=9,r.setVocalVolume(n);case 9:a(n);case 10:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),[r]);return{isSupported:c,volume:i,setVocalVolume:o}}(e.currentTrackUri),n=r.isSupported,i=r.volume,a=r.setVocalVolume,c=(0,P.useCallback)((function(e){n&&a(e.volume)}),[n,a]);if(!n)return null;var o=De.find((function(e){return e.volume===i})),s=(null==o?void 0:o.volume)===Oe.B.SING_ALONG_OFF;return(0,ee.jsx)(Se.yj,{menu:(0,ee.jsxs)(Le.v,{children:[(0,ee.jsx)(Ne.F,{children:V.ag.get("singalong.title")}),De.map((function(e){return(0,ee.jsx)(we.s,{role:"menuitemradio","aria-checked":i===e.volume,"aria-label":e.label,onClick:function(){return c(e)},icon:e.icon,iconPosition:"leading",children:e.label},e.volume)}))]}),children:function(e,r,n){return(0,ee.jsxs)("button",{onClick:r,ref:n,type:"button",className:ye()(Ie,(0,t.Z)({},Te,s)),children:[s?(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(xe.r,{iconSize:16}),(0,ee.jsx)(G.D,{variant:"mesto",children:V.ag.get("singalong.button")})]}):(0,ee.jsxs)(ee.Fragment,{children:[o.icon,(0,ee.jsx)(G.D,{variant:"mesto",children:o.label})]}),e?(0,ee.jsx)(ke.U,{iconSize:16}):(0,ee.jsx)(je.i,{iconSize:16})]})}})})),_e=(0,ee.jsx)("div",{className:le,children:(0,ee.jsx)(p.H,{})}),Ce=(0,ee.jsx)(ge,{version:"error"}),Be=(0,ee.jsx)(ge,{version:"ad"}),Pe=(0,ee.jsx)(ge,{version:"unavailable"}),Ge={active:s.ixZ,inactive:s.Snx,background:s.tGJ,messaging:s.ixZ};const Fe=function(){var e,r,n,c,s=(0,g.$)().getCapabilities().isSupported,p=(0,l.W6)(d.cp)&&s,b=(0,v.O)(),h=(0,f.Y)((function(e){return null==e?void 0:e.item}),(function(e,r){return(null==e?void 0:e.uri)===(null==r?void 0:r.uri)})),x=(null==h?void 0:h.uri)||"",k=(0,m.o)((null==h?void 0:h.images)||void 0,{desiredLabel:"large",desiredSize:600}),j=_(x,k||(null==h||null===(e=h.images)||void 0===e||null===(r=e[0])||void 0===r?void 0:r.url)||"",p),S=j.data,L=j.loading,N=j.error,w=Ge;null!=S&&S.hasLyrics&&(w={active:S.colors.activeText,inactive:S.colors.text,background:S.colors.background,messaging:S.colors.text}),(0,u.Y)(w.background,Ge.background);var O=(0,f.Y)((function(e){var r;return null==e||null===(r=e.nextItems)||void 0===r?void 0:r[0]}),(function(e,r){return(null==e?void 0:e.uri)===(null==r?void 0:r.uri)}));_((null==O?void 0:O.uri)||"",(null==O||null===(n=O.images)||void 0===n||null===(c=n[0])||void 0===c?void 0:c.url)||"",p);var I=_e,T=!1;if(x)if(o().isAd(x))I=Be;else if(N)I=Ce;else if(L)I=_e;else if(S)if(S.hasLyrics){var D,E,C=null!==(D=null===(E=b.activeDevice)||void 0===E?void 0:E.isLocal)&&void 0!==D&&D;T=p&&S.hasVocalRemoval&&C,I=(0,ee.jsx)(ae,{trackUri:x,data:S},x)}else I=Pe;var B=(0,a.v9)((function(e){return e.ads.leaderboard.isEnabled})),P={"--lyrics-color-active":w.active,"--lyrics-color-inactive":w.inactive,"--lyrics-color-background":w.background,"--lyrics-color-messaging":w.messaging};return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(y.$,{usePlayingItem:!0,children:"Spotify"}),(0,ee.jsxs)("div",{className:(0,i.cx)(oe,(0,t.Z)({},se,B)),style:P,children:[(0,ee.jsx)("div",{className:de}),I,T?(0,ee.jsx)("div",{className:ve,children:(0,ee.jsx)(Ee,{currentTrackUri:x})}):null]})]})}}}]);
//# sourceMappingURL=xpui-routes-lyrics.js.map
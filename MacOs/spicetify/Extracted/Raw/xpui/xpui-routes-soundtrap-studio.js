"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[3780],{53587:(e,t,r)=>{r.r(t),r.d(t,{default:()=>S});var s=r(59496),n=r(84875),o=r.n(n),c=r(77646),i=r(86695),a=r(87518),u=r(88585),l=r.n(u),p=r(25007),d=r(62661),f=r(4763),w=r(52340),h=r(83320),I=r(99059);var m=r(7923),g=r(32693),j=r(7209),k=r(42388);const y="_8NXEiIW8UUvsBVNhHdc",b="pZytOOt4d5hSOwPD8A_V";var v=r(4637);const S=(0,s.memo)((()=>{const e=(0,w.n)(),{projectId:t,songId:r}=(0,i.UO)(),n=(0,s.useRef)(null),u=(0,c.I0)(),S=(0,I.z)(),E=(0,a.s0)(),U=(0,s.useMemo)((()=>[["showtippopups",0],["workflow","cover"],["workflowSongId",r]].map((([e,t])=>`${e}=${t}`)).join("&")),[r]),P=(0,c.v9)((e=>e.session.user?.uri)),$=l().from(P).toURLPath(!0),[O,x]=(0,s.useState)(null),{route:C,error:L}=(({redirectUri:e})=>{const t=(0,I.z)(),[r,n]=(0,s.useState)(""),[o,c]=(0,s.useState)(null);return(0,s.useEffect)((()=>{(async()=>{try{const{token:r}=await t.requestAccountLinkToken();n(`https://www.soundtrap.com/spotify/accountlink/?redirect=${encodeURIComponent(e)}&token=${r}`)}catch(e){c("Something went wrong while trying link your account")}})()}),[t,e]),{route:r,error:o}})({redirectUri:`https://www.soundtrap.com/studio/${t}/?${U}`}),{resetMainView:_,collapseMainView:M}=(0,h.i)(),V=(0,g.g)(),z=(0,j.Y)((e=>e?.hasContext&&!e?.isPaused));(0,s.useEffect)((()=>{const e=n.current;return S.setIframe(e),()=>{S.setIframe(null)}}),[n,S,u]),(0,k.I)(m.O.EXIT,(()=>{E(-1)})),(0,k.I)(m.O.PUBLISH,(async({data:e})=>{const t=!e.title||!e.projectId;if(x(null),t)x("Cannot publish project, title or projectId are missing.");else try{await S.publish({projectId:e.projectId,title:e.title,isPrivate:!0===e.isPrivate}),E($,{replace:!0,state:{referrer:"soundtrap_publish",newProjectId:e.projectId}})}catch(e){x("Something went wrong while trying to publish the project.")}})),(0,s.useEffect)((()=>{z&&V?.pause()}),[z,V]),(0,s.useEffect)((()=>(M(),_)),[]);const N=L??O;return N?(0,v.jsx)(f.h,{hasError:!0,errorMessage:N}):(0,v.jsxs)(s.Suspense,{fallback:null,children:[(0,v.jsx)(d.$,{children:p.ag.get("playlist.page-title")}),(0,v.jsx)("iframe",{ref:n,src:C,className:o()(y,{[b]:e}),allow:"microphone https://www.soundtrap.com/studio;",title:"Soundtrap"})]})}))},42388:(e,t,r)=>{r.d(t,{I:()=>o});var s=r(59496),n=r(99059);function o(e,t){const r=(0,n.z)();(0,s.useEffect)((()=>{const s=r.getEvents(),n=e=>t(e);return s.addListener(e,n),()=>{s.removeListener(e,n)}}),[e,r,t])}}}]);
//# sourceMappingURL=xpui-routes-soundtrap-studio.js.map
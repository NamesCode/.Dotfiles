"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[3780],{22578:(e,t,n)=>{n.d(t,{$:()=>p});n(26699),n(32023),n(69600),n(68309),n(21249);var r=n(67294),o=n(64593),u=n(96206),a=n(69691),c=n(8341),i=n(89952),s=n(51615),l=n(24183);function f(e){return e.includes("Spotify")?e:"Spotify – ".concat(e)}var p=function(e){var t,n,p,d,v,m,w,h=e.children,g=e.usePlayingItem,k=f(h);t=h,d=(0,l.Oh)().mainLandmarkRef,v=(0,s.k6)(),m=null===(n=v.location)||void 0===n||null===(p=n.state)||void 0===p?void 0:p.preventMoveFocus,(w=(0,r.useRef)(v.length<2)).current=v.length<2,(0,r.useEffect)((function(){var e=d.current;!m&&!w.current&&e&&t&&(e.setAttribute("aria-label",t),e.focus())}),[t,d,m]);var I=(0,a.IK)().isPlaying,b=(0,c.Y)((function(e){return null==e?void 0:e.item}));return b&&(I||g)&&((0,i.G_)(b)?k=[b.name,b.artists.map((function(e){return e.name})).join(u.ag.getSeparator())].join(" • "):(0,i.iw)(b)?k=[b.name,b.show.name].join(" • "):(0,i.k6)(b)&&(k=f(u.ag.get("ad-formats.advertisement")))),r.createElement(o.q,{defaultTitle:"Spotify",defer:!1},r.createElement("title",null,k))}},57345:(e,t,n)=>{n.r(t),n.d(t,{default:()=>U});var r=n(4942),o=n(15861),u=n(29439),a=n(87757),c=n.n(a),i=(n(69600),n(21249),n(92222),n(67294)),s=n(94184),l=n.n(s),f=n(86706),p=n(51615),d=n(69518),v=n.n(d),m=n(96206),w=n(22578),h=n(6158),g=n(23701),k=n(50709),I=n(67448),b=n(99125),E=n(23716),y=n(8341);function S(e,t){var n=(0,I.z)();(0,i.useEffect)((function(){var r=n.getEvents(),o=function(e){return t(e)};return r.addListener(e,o),function(){r.removeListener(e,o)}}),[e,n,t])}const j="_8NXEiIW8UUvsBVNhHdc",x="pZytOOt4d5hSOwPD8A_V";const U=i.memo((function(){var e=(0,g.n)(),t=(0,p.UO)(),n=t.projectId,a=t.songId,s=(0,i.useRef)(null),d=(0,f.I0)(),U=(0,I.z)(),Z=(0,p.k6)(),O=(0,i.useMemo)((function(){return[["showtippopups",0],["workflow","cover"],["workflowSongId",a]].map((function(e){var t=(0,u.Z)(e,2),n=t[0],r=t[1];return"".concat(n,"=").concat(r)})).join("&")}),[a]),P=(0,f.v9)((function(e){var t;return null===(t=e.session.user)||void 0===t?void 0:t.uri})),L=v().from(P).toURLPath(!0),_=(0,i.useState)(null),C=(0,u.Z)(_,2),M=C[0],R=C[1],V=function(e){var t=e.redirectUri,n=(0,I.z)(),r=(0,i.useState)(""),a=(0,u.Z)(r,2),s=a[0],l=a[1],f=(0,i.useState)(null),p=(0,u.Z)(f,2),d=p[0],v=p[1];return(0,i.useEffect)((function(){(0,o.Z)(c().mark((function e(){var r,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.requestAccountLinkToken();case 3:r=e.sent,o=r.token,l("".concat("https://www.soundtrap.com/spotify/accountlink","/?redirect=").concat(encodeURIComponent(t),"&token=").concat(o)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),v("Something went wrong while trying link your account");case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()}),[n,t]),{route:s,error:d}}({redirectUri:"https://www.soundtrap.com/studio/".concat(n,"/?").concat(O)}),z=V.route,A=V.error,B=(0,k.i)(),N=B.resetMainView,T=B.collapseMainView,q=(0,E.g)(),H=(0,y.Y)((function(e){return(null==e?void 0:e.hasContext)&&!(null!=e&&e.isPaused)}));(0,i.useEffect)((function(){var e=s.current;return U.setIframe(e),function(){U.setIframe(null)}}),[s,U,d]),S(b.O.EXIT,(function(){Z.goBack()})),S(b.O.PUBLISH,function(){var e=(0,o.Z)(c().mark((function e(t){var n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.data,r=!n.title||!n.projectId,R(null),!r){e.next=6;break}return R("Cannot publish project, title or projectId are missing."),e.abrupt("return");case 6:return e.prev=6,e.next=9,U.publish({projectId:n.projectId,title:n.title});case 9:Z.push(L,{referrer:"soundtrap_publish",newProjectId:n.projectId}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),R("Something went wrong while trying to publish the project.");case 15:case"end":return e.stop()}}),e,null,[[6,12]])})));return function(t){return e.apply(this,arguments)}}()),(0,i.useEffect)((function(){H&&(null==q||q.pause())}),[H,q]),(0,i.useEffect)((function(){return T(),N}),[]);var X=null!=A?A:M;return X?i.createElement(h.h,{hasError:!0,errorMessage:X}):i.createElement(i.Suspense,{fallback:null},i.createElement(w.$,null,m.ag.get("playlist.page-title")),i.createElement("iframe",{ref:s,src:z,className:l()(j,(0,r.Z)({},x,e)),allow:"microphone https://www.soundtrap.com/studio;",title:"Soundtrap"}))}))}}]);
//# sourceMappingURL=xpui-routes-soundtrap-studio.js.map